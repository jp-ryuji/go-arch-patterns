# Ent ORM Setup

This directory contains the Ent ORM setup for the project.

## Code Generation Structure

The code generation process has been customized to separate generated code from schema definitions:

- **Schema Definitions**: `internal/infrastructure/postgres/ent/schema/`
  - Contains the schema definition files for each entity
  - These are the hand-written files that define the entity structure and relationships

- **Generated Code**: `internal/infrastructure/postgres/entgen/`
  - Contains all code automatically generated by Ent based on the schemas
  - This includes entity models, query builders, and client code
  - The package name for generated code is `entgen` (not `ent`)

- **Generation Control**: `internal/infrastructure/postgres/ent/generate.go`
  - Contains the go:generate directive that controls code generation
  - Uses the `--target ../entgen` flag to output generated code to the entgen directory

## Schema Generation

The Ent schemas are defined in the `internal/infrastructure/postgres/ent/schema` directory, with one file per entity:

- `caroption.go` - CarOption entity (renamed from Option to avoid conflict)

## Code Generation

To regenerate the Ent code after modifying schemas:

```bash
make gen.ent
```

This command will:

1. Read schema files from `./schema`
1. Generate code using the configuration in `generate.go`
1. Output generated code to `../entgen` (relative to the ent directory)

Alternatively, you can run the generation command directly:

```bash
cd internal/infrastructure/postgres/ent && go run -mod=mod entgo.io/ent/cmd/ent generate --target ../entgen ./schema
```

Note: This requires the ent command to be installed. If you haven't installed it yet, run:

```bash
go get entgo.io/ent/cmd/ent
```

## Database Setup

To run the database migrations:

```bash
DB_HOST=localhost DB_PORT=5433 make migrate
```

> TODO: This can be improved.
